import os
import discord
from discord.ext import commands
from dotenv import load_dotenv

load_dotenv()  # .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰

TOKEN = os.getenv('28e58c41248d7354c5ca4490e5ea1c47a24088f124fc0e5478a1f0a7e8ba53de')  # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—

bot = commands.Bot(command_prefix='!')

@bot.command()
async def new_channel(ctx):
    guild = ctx.guild
    author = ctx.author
    overwrites = {
        guild.default_role: discord.PermissionOverwrite(read_messages=False),
        guild.me: discord.PermissionOverwrite(read_messages=True),
        author: discord.PermissionOverwrite(read_messages=True),
        discord.utils.get(guild.roles, name="æŒ‡å®šã•ã‚ŒãŸãƒ­ãƒ¼ãƒ«å"): discord.PermissionOverwrite(read_messages=True)
    }
    new_channel = await guild.create_text_channel(f"{author.display_name}ã®ãƒãƒ£ãƒ³ãƒãƒ«", overwrites=overwrites)
    await ctx.send(f"{author.mention} æ–°ã—ã„ãƒãƒ£ãƒ³ãƒãƒ«ãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼ {new_channel.mention}")
    await new_channel.set_permissions(author, read_messages=True)

@bot.event
async def on_raw_reaction_add(payload):
    message_id = payload.message_id
    if message_id == 1234567890:  # ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å—ã‘ä»˜ã‘ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®IDã‚’æŒ‡å®š
        guild_id = payload.guild_id
        guild = discord.utils.find(lambda g: g.id == guild_id, bot.guilds)
        member = discord.utils.find(lambda m: m.id == payload.user_id, guild.members)
        if payload.emoji.name == 'ğŸ‘€':
            channel = discord.utils.find(lambda c: c.id == payload.channel_id, guild.channels)
            new_channel = await channel.clone(name=f"{member.display_name}ã®ãƒãƒ£ãƒ³ãƒãƒ«")
            overwrites = {
                guild.default_role: discord.PermissionOverwrite(read_messages=False),
                guild.me: discord.PermissionOverwrite(read_messages=True),
                member: discord.PermissionOverwrite(read_messages=True),
                discord.utils.get(guild.roles, name="æŒ‡å®šã•ã‚ŒãŸãƒ­ãƒ¼ãƒ«å"): discord.PermissionOverwrite(read_messages=True)
            }
            await new_channel.edit(overwrites=overwrites)
            await new_channel.send(f"{member.mention} æ–°ã—ã„ãƒãƒ£ãƒ³ãƒãƒ«ãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼ ã“ã“ã«ã¯ã‚ãªãŸã¨æŒ‡å®šã•ã‚ŒãŸãƒ­ãƒ¼ãƒ«ã®ã¿ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚")

bot.run(TOKEN)